# shell脚本学习
*创建时间：星期四, 19. 十月 2017 09:22上午*
***更新时间：星期四, 19. 十月 2017 09:23上午***

本文主要是《shell脚本学习指南（中文版）》的学习笔记

[TOC]

## `#!` 表示该用何种shell来执行程序

分号(;)用来分割同一行的多个命令；如果用&则表示不用等上一个命令完成就可以继续执行下个命令。

## 变量
- 变量的首字符为字母或下划线，如：`first`。
- 变量赋值等号前后没有空格，如：`first="This is var"`。
- 变量名前跟$可以取出变量的值，如：`$first`。
- 变量再次被赋值给其他变量，用不用双引号都可以，如：`second="$first"`或`second=$first`。
- 被赋予的值之间有空格时必须用双引号。

## 标准输入/输出(标准I/O)
> 程序应该有数据的来源端，数据的目的端（数据要去的地方）以及报告问题的地方，它们分别被称为“标准输入(standard input)”，“标准输出(standard output)”以及“标准错误输出(standard error)”。

## 重定向I/O
- 用`<`改变标准输入
```shell
tr -d 'xxx' < test.file
```
`tr -d 'xxx'`本来的标准输入是从键盘输入的数据，使用`<`后，输入的数据则从`test.file`取来。

- 用`>`改变输出 
```shell
tr -d 'xxx' < test.file > done.file
```
以上命令表示输入数据来源于`test.file`，经`tr`处理后再输出到`done.file`。

```shell
cat > test #用cat复制终端输入到test文件中
echo 123;
^D	# Ctrl+D表示end-of-file
```
本来`cat`的标准输出应该是屏幕，经过`>`重定向将标准输出改变为文件`test`。

`>`输出的文件不存在将自动新建，若存在则会覆盖原有数据。

-  `>>`用于向文档后追加数据
`>>`输出的文件不存在会自动新建，存在则在文档后追加内容。

- 管道(pipeline)`|`
> 如果你是UNIX新手，可以把`<`和`>`想象成数据的漏斗(funnels)——数据会从大的一端进入，从小的一端出来。
> 构建管道时，应该试着让每个阶段的数据量变得更少。
> 如果你有两个要完成的步骤和次序无关，那么应该把让数据变少的步骤放到管道的前面。
```
program1 | program2
```
利用管道`|`将program1的标准输出转变为program2的标准输入。

## `/dev/null`和`/dev/tty`
-  `/dev/null`
传到`/dev/null`的数据都会被系统丢弃。可用于获取命令的退出状态。

- `/dev/tty`?
## `PATH`
- `::`空项目表示当前目录
- 查找顺序：从左到右
例如`PATH=/bin:/usr/bin:/usr/local/bin`先查找`/bin`然后以此向后查找。
## `.profile`
每次登录shell都会读取`.profile`文件，将命令存于此可使其永久生效。

## 位置参数
> 所谓的位置参数指的是shell脚本的命令行参数。如下`$1`即为位置参数，其值是"hikwang"：
```shell
$ cat > finduser
who | grep $1
$ chmod +x finduser
$ ./finduser hikwang
```
位置参数用$1..$9获取，数值超过10则需要用大括号括起，${10}。

## 执行跟踪
`sh -x finduser.sh`，执行命令时加上`-x`可跟踪脚本执行的每个命令，详见`man sh`。
`set -x`和`set +x`分别用于在脚本中打开和关闭执行跟踪。

## BRE正则表达式
### 方括号表达
- 字符集 `[::]`
如`[[:alpha:]]`表示所有英文字母

- 排序`[..]`
> 给予成组的项目排列顺序的操作。
如`[ab[.ch.]c]`匹配a/b/c或者是成对的ch。

- 等价字符集`[==]`
> 用来让不同的字符在匹配时视为同一字符.
如`[=e=]`可匹配e和带音标的e

### 后向引用
> 匹配正则表达式匹配的先前的部分。
规则是:
1. 子表达式包括在`\(`和`\)`之间.支持9个子表达式,可嵌套。
2. 使用`\n`引用前面的表达式,n是1-9。
如`\(ab\)\(cd\)*\2\1`可匹配"abcdcdab"；
`\(['"]\).*\1`可匹配以单双引号括起来的字符。

### `^$`
`^$`可用于匹配空行。
`grep -v '^$'`可以过滤掉空行显示。

## ERE正则表达式
- 没有后向引用
- `\char`表示转义，因而`ab*{n,m}`中`{}`不需要反斜杠
- ERE表达式和JS的正则相似

## `sed`
- `sed`:Stream Editor
- s命令:使用正则表达式匹配，`sed 's/:.*//' /etc/passwd`表示删除/etc/passwd中第一个冒号后的所有东西；
-　`/`为最常用定界符，任何可显示字符都可作为定界符；
- 支持后向匹配，`sed 's;\(/home\)/opt;\1/opts;'` `\1`表示`/home`；
- `&`:?
- `g`表示匹配全部，没有在结尾加`g`则只匹配第一个;
- `sed 's/Tom/Lily/2'` 表示只匹配第二个;
- `-e`
`sed -e 's/Tom/Jery/' -e 's/Lily/Meimei/' myfile.xml > myfile2.xml`
- `-f`
```shell
cat > commond.sed
s/Tom/Jery/
s/Lily/Meimei/
^D
sed -f 'commond.sed' > myfile2.xml
```
- '模式空间(pattern space)'
> sed读取每个文件,一次读一行,将读入的行放入内存的一个区域叫模式空间.
sed读一行文本 --> 放入内存 --> 操作应用于此内存内容 --> 输出 --> 继续读入下一行
- `-n`关闭打印
- `p`打印当前匹配
`sed -n '/<HTML>/p' *.html` 仅显示<HTML>这行
- `#`用于注释,必须单独一行